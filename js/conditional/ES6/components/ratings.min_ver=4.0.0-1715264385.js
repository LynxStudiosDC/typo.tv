"use strict";!function(e){Vue.component("plex-store-ratings",{template:"#plex-store-ratings",props:["store","storeName","ratings"],data:function(){return{ready:!1,loading:!1,lazyLoaded:!1,error:!1,rest:{endpoint:"",nonce:""},userState:{signedIn:!1,hasActivePlexPass:!1},average:0,count:0}},methods:{getRatings:function(){var e=this,t=this.ratings[this.store]||!1;if(t)return this.average=t.average,this.count=t.count,void(this.ready=!0);this.loading=!0;var n=this.rest.endpoint+"?store="+encodeURIComponent(this.store),r={headers:{Accept:"application/json","Content-Type":"application/json"}},a=!1;if(void 0!==plex_l10n.rest_api.optional_nonce&&plex_l10n.rest_api.optional_nonce&&Array.isArray(plex_l10n.rest_api.optional_nonce))try{var o=new URL(n),s=o.pathname;a=plex_l10n.rest_api.optional_nonce.indexOf(s)>=0}catch(e){}a||(r.headers["X-WP-Nonce"]=this.rest.nonce),fetch(n,r).then(function(t){if(!t.ok)throw new Error("HTTP error! status: "+t.status);return e.loading=!1,t.json()}).then(function(t){if(!t.success)throw new Error(t);e.average=t.data.average,e.count=t.data.count,e.ready=!0}).catch(function(t){Plex.debugLog()&&console.error(t),e.error=!0})},theStarIcon:function(e){--e;var t="rating";return this.average>e?this.average<e+1&&(t+="-half"):t+="-empty",document.querySelector(".stores-star-icons .icon-"+t).outerHTML}},computed:{theAvgRating:function(){return+parseFloat(this.average).toFixed(1)},theStoreIcon:function(){var e=document.querySelector(".stores-icons .plex-svg-holder."+this.store)||!1;if(e)return e.outerHTML}},mounted:function(){var e=this,t=function(t){(t=t||!1)&&!t.detail.classList.contains("lazyRatings")||e.lazyLoaded||e.loading||e.ready||(e.rest.endpoint=e.$parent.asRatings.rest.endpoint,e.rest.nonce=e.$parent.asRatings.rest.nonce,e.getRatings())};try{this.userState.signedIn=this.$parent.isSignedIn,this.userState.hasActivePlexPass=this.$parent.hasActivePlexPass}catch(e){}document.getElementById("ratings-placeholder")&&document.getElementById("ratings-placeholder").remove(),document.addEventListener("PlexLazyLoad",function(e){t()})}})}(window);